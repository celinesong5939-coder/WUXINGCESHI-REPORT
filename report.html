.totem-container-3d { position: relative; width: 360px; height: 360px; margin: 0 auto; perspective: 1000px; }
.totem-3d-wrapper { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; }

        /* æ ¸å¿ƒæ˜Ÿçƒ */
        /* æ ¸å¿ƒæ˜Ÿçƒ - è§†è§‰ä¼˜åŒ–ç‰ˆï¼ˆå»é™¤ç°è‰²é˜´å½±ï¼Œå¢åŠ é€šé€æ„Ÿï¼‰ */
.planet-core {
position: absolute; top: 50%; left: 50%; width: 160px; height: 160px; border-radius: 50%;
transform: translate(-50%, -50%);
            /* ä¿æŒé«˜äº®ä¸­å¿ƒï¼Œç¡®ä¿é€šé€æ„Ÿ */
            /* é«˜å…‰ä¸­å¿ƒï¼Œè¾¹ç¼˜é€æ˜ï¼Œå½»åº•æ¶ˆé™¤é»‘å¿ƒ */
background: radial-gradient(circle at 30% 30%, 
rgba(255,255,255,1) 0%, 
                currentColor 40%, 
                rgba(0,0,0,0.2) 150%);
                currentColor 45%, 
                rgba(0,0,0,0.1) 150%);
            /* å¢åŠ åŒè‰²å…‰æ™• */
box-shadow: 
0 0 60px currentColor,
                0 0 30px rgba(255,255,255,0.4) inset;
                0 0 40px rgba(255,255,255,0.3) inset;
z-index: 20; 
animation: planet-rotate 25s linear infinite;
}

        /* ========================================= */
        /* æ ¸å¿ƒä¿®æ”¹ï¼šå¥¢åæµé‡‘å­—ä½“æ ·å¼ (High-End Text) */
        /* ========================================= */
        /* å¥¢åæµé‡‘å­—ä½“æ ·å¼ (é»‘é‡‘æµå…‰ + å¼ºåŠ›æŠ•å½±) */
.element-char {
font-size: 4.5rem;
font-weight: 900;
            font-family: 'Noto Serif SC', serif; /* å¼ºåˆ¶ä½¿ç”¨è¡¬çº¿ä½“å¢åŠ é«˜çº§æ„Ÿ */
            
            /* åˆ¶ä½œæµé‡‘æ¸å˜æ•ˆæœ (Champagne Gold Gradient) */
            background: linear-gradient(180deg, 
                #FFFBEB 0%,   /* é¡¶éƒ¨ï¼šäº®ç™½é‡‘ */
                #FCD34D 40%,  /* ä¸­éƒ¨ï¼šé»„é‡‘ */
                #B45309 100%  /* åº•éƒ¨ï¼šæš—é“œé‡‘ */
            );
            font-family: 'Noto Serif SC', serif;
            /* æµé‡‘æ¸å˜è‰² */
            background: linear-gradient(180deg, #FFFBEB 0%, #FCD34D 40%, #B45309 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
            
            /* å…³é”®ï¼šå¼ºåŠ›æŠ•å½± (Drop Shadow) */
            /* è¿™å±‚é»‘è‰²çš„å½±å­èƒ½ç¡®ä¿é‡‘è‰²å­—ä½“åœ¨ç™½è‰²æ˜Ÿçƒä¸Šä¹Ÿèƒ½æ¸…æ™°æµ®ç° */
            filter: drop-shadow(0 2px 0px rgba(0,0,0,0.5)) drop-shadow(0 5px 10px rgba(0,0,0,0.6));
            
            /* å¼ºåŠ›æŠ•å½±ï¼Œç¡®ä¿åœ¨ç™½è‰²èƒŒæ™¯ä¸Šä¹Ÿæ¸…æ™°å¯è§ */
            filter: drop-shadow(0 2px 0px rgba(0,0,0,0.5)) drop-shadow(0 5px 15px rgba(0,0,0,0.8));
position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 30;
pointer-events: none;
}
@@ -126,18 +117,22 @@
</head>
<body>
<div id="report-app">
        <!-- çŠ¶æ€ä¸€ï¼šåŠ è½½ä¸­ -->
<div v-if="isLoading" class="flex items-center justify-center h-screen text-slate-500">
<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> æ­£åœ¨ä»äº‘ç«¯è§£å¯†æ¡£æ¡ˆ...
</div>

        <!-- çŠ¶æ€äºŒï¼šé”™è¯¯ -->
<div v-else-if="fetchError" class="flex flex-col items-center justify-center h-screen text-center px-4">
<i class="fa-solid fa-triangle-exclamation text-5xl text-red-500 mb-6"></i>
<h2 class="text-2xl font-bold mb-2 text-white">æŠ¥å‘ŠåŠ è½½å¤±è´¥</h2>
<p class="text-slate-400 max-w-sm">{{ fetchError }}</p>
</div>

        <!-- çŠ¶æ€ä¸‰ï¼šå†…å®¹å±•ç¤º -->
<template v-else-if="reportData">
            <div class="save-btn" @click="saveAsImage" title="ä¿å­˜ä¸ºå›¾ç‰‡"><i class="fa-solid fa-camera"></i></div>
            <!-- æˆªå›¾æç¤ºæŒ‰é’® -->
            <div class="save-btn" @click="showSaveTip" title="ä¿å­˜æ¡£æ¡ˆ"><i class="fa-solid fa-camera"></i></div>

<div class="container mx-auto px-4 pb-20 max-w-3xl pt-12">
<header class="text-center mb-16 fade-in-up">
@@ -180,7 +175,7 @@
const container = document.getElementById(containerId);
if (!container) return;

            // 1. å®šä¹‰å­—å…¸ - é‡‘å±æ€§æ”¹ä¸ºé“¶ç™½è‰²ï¼Œå­—ä½“ä¸ºé‡‘è‰²æ¸å˜
            // 1. å®šä¹‰å­—å…¸ - é‡‘æ”¹ä¸ºé“¶ç™½(#f8fafc)é˜²æ­¢å‘ç°
const DICT = {
metal: { color_hex: '#f8fafc', char: 'é‡‘', name: 'é‡‘', glow: 'rgba(248,250,252,0.9)' },
wood:  { color_hex: '#10b981', char: 'æœ¨', name: 'æœ¨', glow: 'rgba(16,185,129,0.7)' },
@@ -271,15 +266,45 @@

onMounted(async () => {
const params = new URLSearchParams(window.location.search);
                    // å‡è®¾ URL é‡Œæœ‰ ?k=XXXXXX æˆ– ?key=XXXXXX
                    const userKey = params.get('k') || params.get('key');
                    const CACHE_KEY = `archetype_cache_${userKey}`;
                    
                    // === 1. ä¼˜å…ˆè¯»å–æœ¬åœ°ç¼“å­˜ (é˜²åˆ·æ–°) ===
                    if (userKey) {
                        const cached = localStorage.getItem(CACHE_KEY);
                        if (cached) {
                            try {
                                console.log("ğŸ”¥ è¯»å–æœ¬åœ°ç¼“å­˜ï¼Œè·³è¿‡APIè¯·æ±‚");
                                const parsed = JSON.parse(cached);
                                reportData.value = parsed;
                                isLoading.value = false;
                                return; // ç›´æ¥ç»“æŸï¼Œä¸è¯·æ±‚åç«¯
                            } catch (e) {
                                localStorage.removeItem(CACHE_KEY);
                            }
                        }
                    }

                    // === 2. æ— ç¼“å­˜åˆ™è¯·æ±‚ API ===
try {
const res = await fetch(`${REPORT_FUNCTION_URL}?${params.toString()}`, {
headers: { 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
});
const data = await res.json();
                        if (!res.ok) throw new Error(data.message || 'Error');

                        if (!res.ok) throw new Error(data.message || 'æŠ¥å‘Šç”Ÿæˆå¤±è´¥');
                        
                        // å¤„ç†æ•°æ®å±‚çº§
const core = data.attributes || data.meta || data;
                        reportData.value = { ...data, ...core, sections: data.sections || core.sections };
                        const finalData = { ...data, ...core, sections: data.sections || core.sections };
                        
                        reportData.value = finalData;
                        
                        // === 3. å­˜å…¥ç¼“å­˜ ===
                        if (userKey) {
                            localStorage.setItem(CACHE_KEY, JSON.stringify(finalData));
                        }

} catch (e) {
fetchError.value = e.message;
@@ -288,6 +313,7 @@
}
});

                // ç›‘å¬æ•°æ®æ¸²æŸ“å›¾è…¾
watch(() => reportData.value, (val) => {
if (val) {
nextTick(() => {
@@ -302,13 +328,19 @@
}
});

                // åŒé‡ä¿é™©æ¸²æŸ“ C7
watch(() => reportData.value?.sections, (secs) => {
if (secs?.length >= 5) setTimeout(renderC7, 1500);
});

                return { isLoading, fetchError, reportData, saveAsImage: () => alert('è¯·ä½¿ç”¨æµè§ˆå™¨æˆªå›¾') };
                // æˆªå›¾æç¤ºå‡½æ•°
                const showSaveTip = () => {
                    alert("ğŸ“· ä¿å­˜æ–¹å¼ï¼š\nè¯·ç›´æ¥ä½¿ç”¨æ‰‹æœºã€æˆªå±ã€‘åŠŸèƒ½ï¼Œæˆ–é•¿æŒ‰é¡µé¢ä¿å­˜ã€‚\nè¿™æ ·èƒ½è·å¾—æœ€é«˜æ¸…çš„çµé­‚å›¾è…¾å“¦ï¼");
                };

                return { isLoading, fetchError, reportData, showSaveTip };
}
}).mount('#report-app');
</script>
</body>
</html>
